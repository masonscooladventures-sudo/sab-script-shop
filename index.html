// EDU Portal ‚Äî React single-file app WITH TIGER BACKGROUND
// Save as App.jsx

import React, { createContext, useContext, useEffect, useState } from 'react';
import { BrowserRouter as Router, Routes, Route, Link, Navigate, useNavigate } from 'react-router-dom';
import { initializeApp } from 'firebase/app';
import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from 'firebase/auth';
import { getFirestore, doc, getDoc, setDoc } from 'firebase/firestore';

// ----- CONFIGURE THIS -----
const firebaseConfig = {
  apiKey: "REPLACE_ME",
  authDomain: "REPLACE_ME",
  projectId: "REPLACE_ME",
  storageBucket: "REPLACE_ME",
  messagingSenderId: "REPLACE_ME",
  appId: "REPLACE_ME"
};
// -------------------------

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const container = { maxWidth: 980, margin: '28px auto', padding: 18, fontFamily: 'Inter, system-ui, sans-serif' };
const card = { background: 'white', padding: 16, borderRadius: 12, boxShadow: '0 6px 18px rgba(2,6,23,0.06)', marginBottom: 16 };

// ----- Auth Context -----
const AuthContext = createContext(null);
export function useAuth(){ return useContext(AuthContext); }

function AuthProvider({ children }){
  const [user, setUser] = useState(null);
  const [role, setRole] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(()=>{
    const unsub = onAuthStateChanged(auth, async (u)=>{
      setLoading(true);
      if(!u){ setUser(null); setRole(null); setLoading(false); return; }
      setUser(u);
      try{
        const rdoc = await getDoc(doc(db, 'roles', u.uid));
        if(rdoc.exists()) setRole(rdoc.data().role || null);
        else setRole(null);
      }catch(e){ console.error('Failed to fetch role', e); setRole(null); }
      setLoading(false);
    });
    return unsub;
  },[]);

  const value = { user, role, loading, signIn: async (email,password)=>{
    await signInWithEmailAndPassword(auth, email, password);
  }, signUp: async (email,password, roleChoice='student')=>{
    const cred = await createUserWithEmailAndPassword(auth, email, password);
    await setDoc(doc(db, 'roles', cred.user.uid), { role: roleChoice });
  }, signOut: ()=>signOut(auth) };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
}

// ----- Protected Routing -----
function ProtectedRoute({ children }){
  const { user, loading } = useAuth();
  if(loading) return <div style={{padding:20}}>Loading...</div>;
  if(!user) return <Navigate to="/signin" replace />;
  return children;
}

function RoleRoute({ allowed = [], children }){
  const { role, loading } = useAuth();
  if(loading) return <div style={{padding:20}}>Loading...</div>;
  if(!role) return <div style={{padding:20}}>No role assigned.</div>;
  return allowed.includes(role) ? children : <div style={{padding:20}}>Access denied.</div>;
}

// ----- Pages -----
function Home(){
  const { user, role } = useAuth();
  return (
    <div style={container}>
      <header style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
        <h1 style={{display:'flex',alignItems:'center',gap:8}}>
          üêÖ <span style={{color:'#1E40AF',fontWeight:700}}>EDU</span>
        </h1>
        <nav>
          <Link to="/">Home</Link> {' | '}
          <Link to="/dashboard">Dashboard</Link> {' | '}
          <Link to="/admin">Admin</Link>
        </nav>
      </header>

      <main>
        <div style={card}>
          <h2>Welcome to EDU</h2>
          <p>Signed in: {user ? user.email : 'No' } {user && role ? `(role: ${role})` : ''}</p>
        </div>
      </main>
    </div>
  );
}

function SignIn(){
  const { signIn, signUp } = useAuth();
  const [email, setEmail] = useState('');
  const [pass, setPass] = useState('');
  const [roleChoice, setRoleChoice] = useState('student');
  const nav = useNavigate();

  async function handleSignIn(e){ e.preventDefault(); try{ await signIn(email,pass); nav('/dashboard'); }catch(err){ alert(err.message); }}
  async function handleSignUp(e){ e.preventDefault(); try{ await signUp(email,pass,roleChoice); nav('/dashboard'); }catch(err){ alert(err.message); }}

  return (
    <div style={container}>
      <div style={{maxWidth:420, margin:'40px auto'}}>
        <div style={card}>
          <h3>Sign in / Create account</h3>
          <form onSubmit={handleSignIn}>
            <div style={{marginBottom:8}}><label>Email</label><input value={email} onChange={e=>setEmail(e.target.value)} style={{width:'100%',padding:8}}/></div>
            <div style={{marginBottom:8}}><label>Password</label><input type="password" value={pass} onChange={e=>setPass(e.target.value)} style={{width:'100%',padding:8}}/></div>
            <div style={{display:'flex',gap:8}}>
              <button type="submit">Sign In</button>
              <button type="button" onClick={handleSignUp}>Create account</button>
            </div>
            <div style={{marginTop:12}}>
              <label>Role:</label>
              <select value={roleChoice} onChange={e=>setRoleChoice(e.target.value)} style={{width:'100%',padding:8}}>
                <option value="student">Student</option>
                <option value="teacher">Teacher</option>
                <option value="admin">Admin</option>
              </select>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}

function Dashboard(){
  const { user, role, signOut } = useAuth();
  return (
    <div style={container}>
      <div style={card}>
        <h2>Dashboard</h2>
        <p>Hello, {user.email} ‚Äî role: {role}</p>
        <button onClick={()=>signOut()}>Sign Out</button>
      </div>
    </div>
  );
}

function Profile(){
  const { user, role } = useAuth();
  return (<div style={container}><div style={card}><h3>Profile</h3><p>Email: {user.email}</p><p>Role: {role}</p></div></div>);
}

function AdminPanel(){
  return (<div style={container}><div style={card}><h3>Admin Panel</h3><p>Use Firestore to assign roles.</p></div></div>);
}

function StudentArea(){ return (<div style={container}><div style={card}><h3>Student Area</h3></div></div>); }
function TeacherArea(){ return (<div style={container}><div style={card}><h3>Teacher Area</h3></div></div>); }

// ----- App root WITH TIGER BACKGROUND -----
export default function App(){
  return (
    <div style={{
      minHeight:'100vh',
      backgroundImage: "url('/mnt/data/A_logo_for_\\"EDU\\"_features_a_snarling_tiger_head_to.png')",
      backgroundSize:'cover',
      backgroundPosition:'center',
      backgroundRepeat:'no-repeat'
    }}>
      <AuthProvider>
        <Router>
          <Routes>
            <Route path="/" element={<Home/>} />
